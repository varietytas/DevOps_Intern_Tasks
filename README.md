# Комментарии к выполненным заданиям

## Task1 - Ansible

- В качестве inventory был использован облачный сервер на ОС Debian 12, под которую и был написан playbook. Тестирование на данном севере прошло успешно
- Playbook использует роль `nginx`, выполняющую все необходимые шаги, предусмотренные условием
- Для серверов Ubuntu была написана роль для удаления предустановленного веб-сервера Apache — `delete_apache`. Необходимость использования `delete_apache` возникает из-за конфликта Apache и Nginx на порту 80
- Сертификаты для сервера были сгенерированы локально, помещены в `files` и скопированы на сервер. Однако имелась идея использования шаблона скрипта, выполняющего генерацию сертификата при его отсутствии непосредственно на сервере. В демонстрационных целях шаблон помещен в `templates`
- Cтраница `index.html` копировалась на сервер и использовалась как индикатор успешной настройки
- Скрипт `run_playbook.sh` для быстрого запуска playbook

Структура проекта:
```
task1_ansible/
├── playbook.yaml
├── inventory.yaml
├── ansible.cfg
├── run_playbook.sh
└── roles/
    ├── nginx/
    │   ├── tasks/
    │   │   └── main.yaml
    │   ├── templates/
    │   │   ├── nginx.conf.j2
    │   │   └── cert_issue.sh.j2
    │   ├── vars/
    │   │   └── main.yaml
    │   ├── defaults/
    │   │   └── main.yaml
    │   └── files/
    │       ├── index.html
    │       ├── cert.crt
    │       └── cert.key
    └── delete_apache/
        └── tasks/
            └── main.yaml
```
Скриншот и лог выполнения playbook в репозитории под именами `ansible_success_screenshot.png` и `ansible.log` соответственно.

## Task2 - Docker

- `nginx.conf` копируется из локальной директории, а не прописывается в `Dockerfile`, что технически и логически соответствует пунктам 1 и 5 требований, так как
  - "`Dockerfile` добавляет конфигурационный файл..." путем копирования
  - "...результат должен включать в себя файлы..." - все перечисленные файлы включены
- `index.html` добавляется в контейнер через bind mount
- `curl -vk https://localhost:443 &> result.txt`

## Task3 - Bash

- Скрипт обеспечивает проверку диска - корневого каталога - на занятый объем в процентах, отправку уведомления на личную почту при заполненности диска более 15%, параметризацию настроек smtp
- Базовые параметры, такие как диск, пороговое значение свободного места и адрес получателя, задаются непосредственно в переменных `CATALOG`, `THRESHOLD` и `TARGET_EMAIL` соответственно
- Параметризация настроек smtp реализована через конфигурационный файл. Путь до файла задается первым параметром запуска со значением по умолчанию `./smtp.conf`. В случае если указанного файла нет по заданному пути, скрипт завершает работу с ошибкой `Error: smtp configuration file not found.`
- Прикреплен шаблон конфигурационного файла - `smtp_template.conf`
- Для передачи сообщения по smtp используется `curl` с указанием на временный файл с содержанием письма.

## Task4 - CI/CD

- В качестве CI платформы был использован GitHub Actions
- Все файлы с результатом работы пайплайна, включая скриншот успешного выполнения, файл workflow и выгруженные с платформы логи, размещены в директории `result`
- В качестве теcтового приложения был использован модифицированный результат из задания 2: `Dockerfile` включает прямое копирование файла `index.html`; контейнер запускается без использования Docker Compose
- Пайплайн подразумевает, что Docker установлен и запущен на целевом сервере
- Пайплайн протестирован на сервере с ОС Debian 12
- Для подключения к серверу используются `Repository secrets`
